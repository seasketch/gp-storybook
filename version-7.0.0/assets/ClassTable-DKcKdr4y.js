import{j as t}from"./jsx-runtime-DEdD30eg.js";import{n as M}from"./helpers-DgG4-pmm.js";import{k as F,b as w}from"./objective-Caaevdh9.js";import{p as B}from"./number-cRyP0T_7.js";import{v,H as V}from"./valueFormatter-CwWsdtmz.js";import"./geographies-Dy7PGO2y.js";import"./ReportDecorator-BKqhhKaH.js";import{T as R}from"./Table-DU7L5fPt.js";import{L as T}from"./LayerToggle-I347XAEB.js";import{R as q}from"./ReportTableStyled-YHOh9k4c.js";import{d as G}from"./styled-components.browser.esm-Cwi-fKCl.js";import{T as N}from"./Tooltip-B8XPMhwM.js";import{u as D}from"./useTranslation-SdK8TBCK.js";import{I as L}from"./InfoCircleFill.esm-CjhE5QEd.js";import{C as P}from"./CheckCircleFill.esm-DtBQOjIm.js";const z=(c,u)=>{if(u){const s=F(c.classes,i=>i.classId)[u];if(!s)throw new Error(`Data class with classId = ${u} not found in metricGroup ${c.metricId}`);if(s.objectiveId)return s.objectiveId}if(!c.objectiveId)throw new Error(`No objectiveId found for metricGroup ${c.metricId} or its class ${u}`);return c.objectiveId},W=G(q)`
  .styled {
    font-size: 13px;
    td {
      padding: 6px 5px;
    }
  }
`,_=({rows:c,columnConfig:u,metricGroup:p,objective:s})=>{const{t:i}=D(),h=F(p.classes,y=>y.classId),m=M(c,["classId","metricId"]),b=Object.keys(m).map(y=>({classId:y})),S=(y=>{const $=100/y.length,A=i("Class"),O=i("Map"),E=i("Target"),H=i("Goal"),k=i("Value");return y.map(e=>{const f={width:`${e.width||$}%`,...e.colStyle?e.colStyle:{}};switch(e.type){case"class":return{Header:e.columnLabel||A,accessor:r=>{var a;return i((a=h[r.classId||"missing"])==null?void 0:a.display)||"missing"},style:f};case"metricValue":return{Header:e.columnLabel||k,accessor:r=>{if(!e.metricId)throw new Error("Missing metricId in column config");const n=m[r.classId]&&m[r.classId][e.metricId]?m[r.classId][e.metricId][0].value:0,a=(()=>{var d;if(Number.isNaN(n)){const g=(((d=h[r.classId||"missing"])==null?void 0:d.display)||"This feature class")+" not found in the selected planning area";return t.jsx(N,{text:g,placement:"bottom",offset:{horizontal:0,vertical:5},children:t.jsx(L,{size:14,style:{color:"#83C6E6"}})})}else return t.jsx(t.Fragment,{})})(),l=(()=>{const d=Number.isNaN(n)?0:n;return e.valueFormatter?v(d,e.valueFormatter):d})();return t.jsxs(t.Fragment,{children:[l,e.valueLabel?` ${e.valueLabel}`:"",a]})},style:f};case"metricChart":return{Header:e.columnLabel||" ",style:{textAlign:"center",...f},accessor:(r,n)=>{var j;if(!e.metricId)throw new Error("Missing metricId in column config");const a=m[r.classId]&&m[r.classId][e.metricId]?m[r.classId][e.metricId][0].value:0,l=(()=>{if(!s)return 0;if(Array.isArray(s)){const o=z(p,r.classId),x=Array.isArray(s)?w(o,s):s;return e.valueFormatter==="percent"?x.target*100:x.target}else return e.valueFormatter==="percent"?s.target*100:s.target})(),d=(((j=h[r.classId||"missing"])==null?void 0:j.display)||"This feature class")+" not found in the selected planning area",g={...e.chartOptions?e.chartOptions:{},rows:[[[e.valueFormatter==="percent"?a*100:a]]],rowConfigs:[{title:o=>t.jsxs(t.Fragment,{children:[Number.isNaN(o)?t.jsx(N,{text:d,placement:"bottom",offset:{horizontal:0,vertical:5},children:t.jsx(L,{size:14,style:{color:"#83C6E6"}})}):l&&o>=l?t.jsx(P,{size:14,style:{color:"#78c679",paddingRight:5}}):t.jsx(t.Fragment,{}),B(Number.isNaN(o)?0:o/100)]})}],max:100};let I;return typeof e.targetValueFormatter=="function"?I=e.targetValueFormatter(l,n,b.length):I=o=>n===b.length-1?`${E} - ${v(o/100,"percent0dig")}`:"",t.jsx("div",{style:{display:"flex",alignItems:"center"},children:t.jsx("div",{style:{flex:1},children:t.jsx(V,{blockGroupNames:["foo"],blockGroupStyles:[{backgroundColor:"#ACD0DE"}],showTitle:!0,showLegend:!1,showTargetLabel:!0,targetLabelPosition:"bottom",showTotalLabel:!1,barHeight:12,target:l||void 0,targetValueFormatter:I,...g})})})}};case"metricGoal":return{Header:e.columnLabel||H,style:f,accessor:r=>{const n=z(p,r.classId),a=Array.isArray(s)?w(n,s):s;if(!a)throw new Error(`Missing objective for objectiveId ${n}`);return e.valueFormatter?v(a.target,e.valueFormatter):`${a.target}${e.valueLabel?` ${e.valueLabel}`:""}`}};case"layerToggle":return{Header:e.columnLabel||O,style:{textAlign:"center",...f},accessor:(r,n)=>{const a=!p.layerId,l=p.layerId||h[r.classId].layerId;return a&&l?t.jsx(T,{simple:!0,size:"small",layerId:l,style:{marginTop:0,justifyContent:"center"}}):!a&&l&&n===0?t.jsx(T,{simple:!0,size:"small",layerId:l,style:{marginTop:0,justifyContent:"center"}}):t.jsx(t.Fragment,{})}};default:throw new Error(`Unexpected ClassTableColumnConfig type ${e.type}`)}})})(u);return t.jsx(W,{children:t.jsx(R,{className:"styled",columns:S,data:b})})};_.__docgenInfo={description:`Table displaying class metrics, one class per table row.  Having more than one metric per class may yield unexpected results
Returns 0 value in table when faced with a 'missing' metric instead of erroring
Handles "class has no value" NaN situation (common when sketch doesn't overlap with a geography) by overwriting with 0 and adding information circle`,methods:[],displayName:"ClassTable",props:{rows:{required:!0,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"metricSchema"}],raw:"z.infer<typeof metricSchema>"}],raw:"Metric[]"},description:"Table row objects, each expected to have a classId and value."},metricGroup:{required:!0,tsType:{name:"z.infer",elements:[{name:"metricGroupSchema"}],raw:"z.infer<typeof metricGroupSchema>"},description:"Source for metric class definitions. if group has layerId at top-level, will display one toggle for whole group"},objective:{required:!1,tsType:{name:"union",raw:"Objective | Objective[]",elements:[{name:"z.infer",elements:[{name:"objectiveSchema"}],raw:"z.infer<typeof objectiveSchema>"},{name:"Array",elements:[{name:"z.infer",elements:[{name:"objectiveSchema"}],raw:"z.infer<typeof objectiveSchema>"}],raw:"Objective[]"}]},description:"Optional objective for metric"},columnConfig:{required:!0,tsType:{name:"Array",elements:[{name:"ClassTableColumnConfig"}],raw:"ClassTableColumnConfig[]"},description:"configuration of one or more columns to display"}}};export{_ as C};
