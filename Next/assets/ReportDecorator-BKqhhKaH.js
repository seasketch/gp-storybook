import{j as b}from"./jsx-runtime-DEdD30eg.js";import{R as re,r as _,g as F}from"./index-RYns6xqu.js";import"./index-BKD8Dact.js";import{c as ne}from"./cloneDeep-DjGZ9tLP.js";const K=re.createContext(null),T={sketchProperties:{name:"My Sketch",id:"abc123",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),sketchClassId:"efg345",isCollection:!1,userAttributes:[{exportId:"DESIGNATION",fieldType:"ChoiceField",label:"Designation",value:"Marine Reserve"},{exportId:"COMMENTS",fieldType:"TextArea",label:"Comments",value:"This is my MPA and it is going to be the greatest. Amazing."}]},geometryUri:"",projectUrl:"https://example.com/project",visibleLayers:["a"],language:"en"},oe=o=>({...T,...o,sketchProperties:{...T.sketchProperties,...o==null?void 0:o.sketchProperties}}),U=[{name:"English",localName:"English",code:"EN"},{name:"Spanish",localName:"Español",code:"es"},{name:"Dhivehi",localName:"ދިވެހި,",code:"dv",rtl:!0},{name:"Portuguese",localName:"Portuguese",code:"pt"},{name:"Portuguese (Brazil)",localName:"Portuguese (Brasil)",code:"pt-br"},{name:"Norwegian",localName:"Norsk",code:"no"},{name:"Kosraean",localName:"Kosraean",code:"kos"},{name:"Samoan",localName:"Samoan",code:"sm"},{name:"Chuukese",localName:"Chuukese",code:"CHK"},{name:"Fijian",localName:"Na vosa vaka-Viti",code:"fj"},{name:"Fiji Hindi",localName:"फ़िजी हिंदी",code:"fh"},{name:"Hawaiian",localName:"ʻŌlelo Hawaiʻi",code:"haw"},{name:"French",localName:"Français",code:"fr"},{name:"German",localName:"Deutsch",code:"de"},{name:"Croatian",localName:"Hrvatski",code:"hr"},{name:"Afrikaans",localName:"Afrikaans",code:"af"},{name:"Chinese",localName:"中文",code:"zh-Hans"},{name:"Arabic",localName:"اَلْعَرَبِيَّةُ",code:"ar",rtl:!0},{name:"Dutch",code:"nl",localName:"Nederlands"},{name:"Italian",code:"it",localName:"Italiano"},{name:"Bulgarian",code:"bg",localName:"български"},{code:"fr-be",name:"French (Belgium)",localName:"Français (Belgique)"},{code:"el",name:"Greek",localName:"Ελληνικά"},{name:"Hindi",code:"hi",localName:"हिन्दी"},{name:"Indonesian",code:"id",localName:"Bahasa Indonesia"},{name:"Maori",code:"mi",localName:"Te Reo Māori"},{name:"Polish",code:"pl",localName:"Polski"},{name:"Romanian",code:"ro",localName:"Română"},{name:"Tongan",code:"to",localName:"lea fakatonga"},{name:"Zulu",code:"zu",localName:"isiZulu"},{name:"Swedish",code:"sv",localName:"Svenska"},{name:"Swedish (Finland)",code:"sv-fi",localName:"Svenska (Finland)"},{name:"Estonian",code:"et",localName:"Eesti"},{name:"Latvian",code:"lv",localName:"Latviešu"},{name:"Lithuanian",code:"lt",localName:"Lietuvių"},{name:"Russian",code:"ru",localName:"Русский"},{name:"Danish",code:"da",localName:"Dansk"}];function X(){const o=_.useContext(K);if(!o)throw new Error("ReportContext could not be found.");function c(u){o&&o.changeLanguage&&o.changeLanguage(u)}const i=U.find(u=>u.code===o.language)||U[0];return[i.code,c,i.rtl||!1]}const Y=()=>{const[o,c]=X();return b.jsx("select",{value:o,onChange:i=>c(i.target.value),title:"Language switcher",children:U.map(i=>b.jsx("option",{value:i.code,children:i.name},i.code))})};Y.__docgenInfo={description:"",methods:[],displayName:"LanguageSwitcher"};var z;(function(o){o.HEADER="header",o.QUERY="query"})(z||(z={}));var V;(function(o){o.HEADER="header",o.QUERY="query"})(V||(V={}));var J;(function(o){o.HTTP="http",o.HTTPS="https"})(J||(J={}));var W;(function(o){o.MD5="md5",o.CRC32="crc32",o.CRC32C="crc32c",o.SHA1="sha1",o.SHA256="sha256"})(W||(W={}));var G;(function(o){o[o.HEADER=0]="HEADER",o[o.TRAILER=1]="TRAILER"})(G||(G={}));var Z;(function(o){o.PROFILE="profile",o.SSO_SESSION="sso-session",o.SERVICES="services"})(Z||(Z={}));var Q;(function(o){o.HTTP_0_9="http/0.9",o.HTTP_1_0="http/1.0",o.TDS_8_0="tds/8.0"})(Q||(Q={}));var I;(function(o){o.STANDARD="standard",o.ADAPTIVE="adaptive"})(I||(I={}));I.STANDARD;const P={},j=new Array(64);for(let o=0,c=65,i=90;o+c<=i;o++){const u=String.fromCharCode(o+c);P[u]=o,j[o]=u}for(let o=0,c=97,i=122;o+c<=i;o++){const u=String.fromCharCode(o+c),l=o+26;P[u]=l,j[l]=u}for(let o=0;o<10;o++){P[o.toString(10)]=o+52;const c=o.toString(10),i=o+52;P[c]=i,j[i]=c}P["+"]=62;j[62]="+";P["/"]=63;j[63]="/";for(let o=0;o<256;o++){let c=o.toString(16).toLowerCase();c.length===1&&(c=`0${c}`)}const B=function(){const o=Object.getPrototypeOf(this).constructor,c=Function.bind.apply(String,[null,...arguments]),i=new c;return Object.setPrototypeOf(i,o.prototype),i};B.prototype=Object.create(String.prototype,{constructor:{value:B,enumerable:!1,writable:!0,configurable:!0}});Object.setPrototypeOf(B,String);var E=(o=>(o.Pending="pending",o.Completed="completed",o.Failed="failed",o))(E||{}),ae=function o(c,i){if(c===i)return!0;if(c&&i&&typeof c=="object"&&typeof i=="object"){if(c.constructor!==i.constructor)return!1;var u,l,h;if(Array.isArray(c)){if(u=c.length,u!=i.length)return!1;for(l=u;l--!==0;)if(!o(c[l],i[l]))return!1;return!0}if(c.constructor===RegExp)return c.source===i.source&&c.flags===i.flags;if(c.valueOf!==Object.prototype.valueOf)return c.valueOf()===i.valueOf();if(c.toString!==Object.prototype.toString)return c.toString()===i.toString();if(h=Object.keys(c),u=h.length,u!==Object.keys(i).length)return!1;for(l=u;l--!==0;)if(!Object.prototype.hasOwnProperty.call(i,h[l]))return!1;for(l=u;l--!==0;){var y=h[l];if(!o(c[y],i[y]))return!1}return!0}return c!==c&&i!==i};const se=F(ae);function ie(o){const c=_.useRef();return se(c.current,o)||(c.current=o),c.current}const M=async(o,c,i,u,l)=>{const h=new URL(o);h.searchParams.append("geometryUri",c.geometryUri),h.searchParams.append("extraParams",c.extraParams||"{}"),h.searchParams.append("cacheKey",c.cacheKey||""),u&&(h.searchParams.append("checkCacheOnly","true"),h.searchParams.append("onConnect",""+l));const g=await(await fetch(h.toString(),{signal:i,method:"get",headers:{"Content-Type":"application/json"}})).json();if(i.aborted)throw new Error("Request aborted");return g},ce=async(o,c,i,u,l,h)=>{M(o,c,i.signal,!0,!1).then(g=>{g.data!==void 0&&g.data&&(u({loading:!1,task:g,error:g.error}),h.close(1e3,l))})};var k={exports:{}};(function(o,c){(function(i){o.exports=i()})(function(i){var u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function l(s,a){var t=s[0],e=s[1],n=s[2],r=s[3];t+=(e&n|~e&r)+a[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[1]-389564586|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[2]+606105819|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[3]-1044525330|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[6]-1473231341|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[7]-45705983|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[10]-42063|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[11]-1990404162|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[13]-40341101|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[14]-1502002290|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[15]+1236535329|0,e=(e<<22|e>>>10)+n|0,t+=(e&r|n&~r)+a[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[11]+643717713|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[0]-373897302|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[10]+38016083|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[15]-660478335|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[4]-405537848|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[3]-187363961|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[8]+1163531501|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[2]-51403784|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[7]+1735328473|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[12]-1926607734|0,e=(e<<20|e>>>12)+n|0,t+=(e^n^r)+a[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[11]+1839030562|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[14]-35309556|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[7]-155497632|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[10]-1094730640|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[0]-358537222|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[3]-722521979|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[6]+76029189|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[12]-421815835|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[15]+530742520|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[2]-995338651|0,e=(e<<23|e>>>9)+n|0,t+=(n^(e|~r))+a[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[14]-1416354905|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[5]-57434055|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[10]-1051523|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[1]-2054922799|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[15]-30611744|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[6]-1560198380|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[13]+1309151649|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[2]+718787259|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[9]-343485551|0,e=(e<<21|e>>>11)+n|0,s[0]=t+s[0]|0,s[1]=e+s[1]|0,s[2]=n+s[2]|0,s[3]=r+s[3]|0}function h(s){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=s.charCodeAt(t)+(s.charCodeAt(t+1)<<8)+(s.charCodeAt(t+2)<<16)+(s.charCodeAt(t+3)<<24);return a}function y(s){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=s[t]+(s[t+1]<<8)+(s[t+2]<<16)+(s[t+3]<<24);return a}function g(s){var a=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,r,v,w,N;for(e=64;e<=a;e+=64)l(t,h(s.substring(e-64,e)));for(s=s.substring(e-64),n=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=s.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(l(t,r),e=0;e<16;e+=1)r[e]=0;return v=a*8,v=v.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(v[2],16),N=parseInt(v[1],16)||0,r[14]=w,r[15]=N,l(t,r),t}function m(s){var a=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,r,v,w,N;for(e=64;e<=a;e+=64)l(t,y(s.subarray(e-64,e)));for(s=e-64<a?s.subarray(e-64):new Uint8Array(0),n=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=s[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(l(t,r),e=0;e<16;e+=1)r[e]=0;return v=a*8,v=v.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(v[2],16),N=parseInt(v[1],16)||0,r[14]=w,r[15]=N,l(t,r),t}function x(s){var a="",t;for(t=0;t<4;t+=1)a+=u[s>>t*8+4&15]+u[s>>t*8&15];return a}function C(s){var a;for(a=0;a<s.length;a+=1)s[a]=x(s[a]);return s.join("")}C(g("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function s(a,t){return a=a|0||0,a<0?Math.max(a+t,0):Math.min(a,t)}ArrayBuffer.prototype.slice=function(a,t){var e=this.byteLength,n=s(a,e),r=e,v,w,N,H;return t!==i&&(r=s(t,e)),n>r?new ArrayBuffer(0):(v=r-n,w=new ArrayBuffer(v),N=new Uint8Array(w),H=new Uint8Array(this,n,v),N.set(H),w)}}();function p(s){return/[\u0080-\uFFFF]/.test(s)&&(s=unescape(encodeURIComponent(s))),s}function S(s,a){var t=s.length,e=new ArrayBuffer(t),n=new Uint8Array(e),r;for(r=0;r<t;r+=1)n[r]=s.charCodeAt(r);return a?n:e}function f(s){return String.fromCharCode.apply(null,new Uint8Array(s))}function A(s,a,t){var e=new Uint8Array(s.byteLength+a.byteLength);return e.set(new Uint8Array(s)),e.set(new Uint8Array(a),s.byteLength),e}function R(s){var a=[],t=s.length,e;for(e=0;e<t-1;e+=2)a.push(parseInt(s.substr(e,2),16));return String.fromCharCode.apply(String,a)}function d(){this.reset()}return d.prototype.append=function(s){return this.appendBinary(p(s)),this},d.prototype.appendBinary=function(s){this._buff+=s,this._length+=s.length;var a=this._buff.length,t;for(t=64;t<=a;t+=64)l(this._hash,h(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},d.prototype.end=function(s){var a=this._buff,t=a.length,e,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)n[e>>2]|=a.charCodeAt(e)<<(e%4<<3);return this._finish(n,t),r=C(this._hash),s&&(r=R(r)),this.reset(),r},d.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},d.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},d.prototype.setState=function(s){return this._buff=s.buff,this._length=s.length,this._hash=s.hash,this},d.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},d.prototype._finish=function(s,a){var t=a,e,n,r;if(s[t>>2]|=128<<(t%4<<3),t>55)for(l(this._hash,s),t=0;t<16;t+=1)s[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(e[2],16),r=parseInt(e[1],16)||0,s[14]=n,s[15]=r,l(this._hash,s)},d.hash=function(s,a){return d.hashBinary(p(s),a)},d.hashBinary=function(s,a){var t=g(s),e=C(t);return a?R(e):e},d.ArrayBuffer=function(){this.reset()},d.ArrayBuffer.prototype.append=function(s){var a=A(this._buff.buffer,s),t=a.length,e;for(this._length+=s.byteLength,e=64;e<=t;e+=64)l(this._hash,y(a.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(a.buffer.slice(e-64)):new Uint8Array(0),this},d.ArrayBuffer.prototype.end=function(s){var a=this._buff,t=a.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,r;for(n=0;n<t;n+=1)e[n>>2]|=a[n]<<(n%4<<3);return this._finish(e,t),r=C(this._hash),s&&(r=R(r)),this.reset(),r},d.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},d.ArrayBuffer.prototype.getState=function(){var s=d.prototype.getState.call(this);return s.buff=f(s.buff),s},d.ArrayBuffer.prototype.setState=function(s){return s.buff=S(s.buff,!0),d.prototype.setState.call(this,s)},d.ArrayBuffer.prototype.destroy=d.prototype.destroy,d.ArrayBuffer.prototype._finish=d.prototype._finish,d.ArrayBuffer.hash=function(s,a){var t=m(new Uint8Array(s)),e=C(t);return a?R(e):e},d})})(k);var le=k.exports;const ue=F(le);var fe=function o(c){if(typeof c=="number"&&isNaN(c))throw new Error("NaN is not allowed");if(typeof c=="number"&&!isFinite(c))throw new Error("Infinity is not allowed");return c===null||typeof c!="object"?JSON.stringify(c):c.toJSON instanceof Function?o(c.toJSON()):Array.isArray(c)?`[${c.reduce((l,h,y)=>`${l}${y===0?"":","}${o(h===void 0||typeof h=="symbol"?null:h)}`,"")}]`:`{${Object.keys(c).sort().reduce((u,l)=>{if(c[l]===void 0||typeof c[l]=="symbol")return u;const h=u.length===0?"":",";return`${u}${h}${o(l)}:${o(c[l])}`},"")}}`};const he=F(fe),de=(o,c,i={})=>{let u=`${o}-${c.id}-${c.updatedAt}`;if(Object.keys(i).length>0){const l=he(i),h=ue.hash(JSON.stringify(l));u=`${u}-${h}`}return u},$=new Map;let O=[],L=[],D={};const pe=(o,c={})=>{const i=_.useContext(K);if(!i)throw new Error("ReportContext not set.");const[u,l]=_.useState({loading:!0}),h=ie(c);let y;return _.useEffect(()=>{const g=new AbortController;if(l({loading:!0}),i.exampleOutputs){const m=i.exampleOutputs.find(x=>x.functionName===o);!m&&!i.simulateLoading&&!i.simulateError&&l({loading:!1,error:`Could not find example data for sketch "${i.sketchProperties.name}" and function "${o}". Run \`npm test\` to generate example outputs`}),l({loading:i.simulateLoading?i.simulateLoading:!1,task:{id:"abc123",location:"https://localhost/abc123",service:"https://localhost",logUriTemplate:"https://localhost/logs/abc123",geometryUri:"https://localhost/geometry/abc123",wss:"",status:E.Completed,startedAt:new Date().toISOString(),duration:0,data:(m||{}).results,error:i.simulateError?i.simulateError:void 0,estimate:0},error:i.simulateError?i.simulateError:void 0})}else{if(!i.projectUrl&&i.geometryUri){l({loading:!1,error:"Client Error - ReportContext.projectUrl not specified"});return}(async()=>{let m;try{m=await me(i.projectUrl,g.signal)}catch{if(!g.signal.aborted){l({loading:!1,error:`Fetch of GeoprocessingProject metadata failed ${i.projectUrl}`});return}}let x,C;if(o.startsWith("https:"))x=o;else{const f=m.geoprocessingServices.find(A=>A.title===o);if(!f){l({loading:!1,error:`Could not find service for function titled ${o}`});return}x=f.endpoint,C=f==null?void 0:f.executionMode}const p={geometryUri:i.geometryUri,extraParams:JSON.stringify(c)};if(i.sketchProperties.id&&i.sketchProperties.updatedAt){const f=de(o,i.sketchProperties,c);p.cacheKey=f}if(p.cacheKey){const f=$.get(p.cacheKey);if(f){l({loading:!1,task:f,error:f.error});return}}let S;if(p.cacheKey){const f=O.find(A=>A.cacheKey===p.cacheKey&&A.functionName===o);f&&(l({loading:!0,task:f.task,error:void 0}),S=f.promise)}if(!S&&(l({loading:!0,task:void 0,error:void 0}),S=M(x,p,g.signal,!1,!1),p.cacheKey)){const f={cacheKey:p.cacheKey,functionName:o,promise:S};O.push(f),S.finally(()=>{O=O.filter(A=>A!==f)})}S.then(f=>{var R,d;const A=f.service;if(A&&f.status!=="completed"&&((R=f.wss)==null?void 0:R.length)>0&&C==="async"){const s=encodeURIComponent(A),a=encodeURIComponent(p.cacheKey||""),t=f.wss+"?serviceName="+s+"&cacheKey="+a+"&fromClient=true";ge(f,t,l,p.cacheKey,x,p,o,g,y)}if(!f.status||!["pending","completed","failed"].includes(f.status)){l({loading:!1,task:f,error:"Could not parse response from geoprocessing function."});return}if(l({loading:f.status===E.Pending,task:f,error:f.error}),p.cacheKey&&f.status===E.Completed&&$.set(p.cacheKey,ne(f)),f.status===E.Pending){((d=f.wss)==null?void 0:d.length)>0&&l({loading:!0,task:f,error:f.error});return}}).catch(f=>{g.signal.aborted||l({loading:!1,error:f.toString()})})})()}return()=>{g.abort()}},[i.geometryUri,i.sketchProperties,o,h]),u},ge=(o,c,i,u,l,h,y,g,m)=>(m===void 0&&(m=new WebSocket(c)),m.addEventListener("open",function(){const x=$.get(u);if(x){i({loading:!1,task:x,error:x.error}),m.close();return}M(l,h,g.signal,!0,!0).then(p=>{if(p.service===y&&JSON.stringify(p)&&p.id!=="NO_CACHE_HIT"&&p.data){i({loading:!1,task:p,error:p.error}),m.close(1e3,y);return}})}),m.onmessage=function(x){var p;const C=JSON.parse(x.data);if(x.data.timestamp){const S=Date.now();console.log(`timestamp ${y}: ${x.data.timestamp}`),console.log(`received ${y}: ${S}`),console.log(`diff ${y}: ${S-x.data.timestamp}`)}C.cacheKey===u&&C.serviceName===y&&(h.cacheKey=u,((p=C.failureMessage)==null?void 0:p.length)>0?(o.error=C.failureMessage,o.status=E.Failed,i({loading:!1,task:o,error:o.error}),m.close()):ce(l,h,g,i,y,m))},m.addEventListener("close",function(){}),m.onerror=function(){var x;((x=m.url)==null?void 0:x.length)>0&&i({loading:!1,error:"Error loading results. Unexpected socket error."})},m),me=async(o,c)=>{const i=L.find(l=>l.url===o);if(i)return i.promise;if(o in D)return D[o];const u=fetch(o,{signal:c}).then(async l=>{const h=await l.json();if(c.aborted)throw new Error("Aborted");return D[o]=h,L=L.filter(y=>y.url!==o),h});return L.push({url:o,promise:u}),u};pe.reset=()=>{D={}};const ee=({style:o,children:c})=>{const[i,u,l]=X();return b.jsx("div",{style:o,dir:l?"rtl":"ltr",children:c})};ee.__docgenInfo={description:"Controls text direction for report based on current language",methods:[],displayName:"ReportTextDirection",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""}}};const ye={height:"auto",border:"1px solid rgba(0,0,0,0.12)",marginLeft:"auto",marginRight:"auto",borderRadius:2,position:"relative"},xe={backgroundColor:"#efefef",padding:8,margin:0,boxSizing:"border-box",boxShadow:"0px 0px 0px transparent, 0px 4px 4px 0px rgba(0, 0, 0, 0.06) inset, 0px 0px 0px transparent, 0px 0px 0px transparent"},be={fontFamily:"sans-serif",padding:10,backgroundColor:"#f5f5f5",zIndex:2,borderBottom:"1px solid rgba(0,0,0,0.13)"},q=({value:o={},children:c})=>{const[i,u]=_.useState(500),l=oe({changeLanguage:g=>{y(m=>{const x=m.language!==g;return{...m,language:x?g:m.language}})},...o}),[h,y]=_.useState(l);return b.jsx(K.Provider,{value:{...h},children:b.jsxs("div",{style:{width:i,...ye},children:[b.jsx("div",{style:be,children:b.jsx("h1",{style:{fontSize:18,fontWeight:500},children:"Sketch Name"})}),b.jsx(ee,{style:{...xe,width:i},children:c}),b.jsxs("div",{className:"storyControls",style:{position:"absolute",bottom:-30,display:"flex",justifyContent:"space-evenly",alignItems:"center",width:"100%"},children:[b.jsx(Y,{}),b.jsxs("select",{value:i,onChange:g=>u(Number.parseInt(g.target.value)),children:[b.jsx("option",{value:500,children:"Desktop - Standard Size"}),b.jsx("option",{value:800,children:"Desktop - Large"}),b.jsx("option",{value:320,children:"iPhone 5"}),b.jsx("option",{value:375,children:"iPhone 6, iPhone X"}),b.jsx("option",{value:414,children:"iPhone 6 Plus, iPhone 8 Plus, iPhone XR"}),b.jsx("option",{value:360,children:"Galaxy S5"}),b.jsx("option",{value:412,children:"Nexus 5x"}),b.jsx("option",{value:540,children:"Pixel"})]})]})]})})};q.__docgenInfo={description:`Wraps a story to look and behave like a sketch report
It also replicates much of the functionality of App.tx like setting text
direction and loading ReportContext.
The context value can be added to or overridden by passing a value prop
Layout includes a language switcher (connected to the report context)
and a report width selector
The caller must wrap the story in a Translator component to provide translations`,methods:[],displayName:"ReportStoryLayout",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},value:{required:!1,tsType:{name:"Partial",elements:[{name:"ReportContextValue"}],raw:"Partial<ReportContextValue>"},description:"Optional ReportContext partial to merge",defaultValue:{value:"{}",computed:!1}}}};const te=o=>b.jsx(q,{children:o()}),we=te,Ne=o=>c=>b.jsx(q,{value:o,children:c()});te.__docgenInfo={description:"Decorator that renders a story into ReportStoryLayout.",methods:[],displayName:"ReportDecorator"};export{Y as L,we as R,te as a,K as b,Ne as c,T as d,X as e,U as l,oe as s,pe as u};
